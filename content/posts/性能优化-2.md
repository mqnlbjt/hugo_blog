---
title: "性能优化 2"
date: 2025-08-05T22:12:35+08:00
draft: false
tags: [性能优化]
---

## 梯度压测

使用梯度压测可以很快得到系统的性能上限。

方法：不断增加线程和请求数。

+ 使用线程：5，然后循环5000次，共2.5万个样本
+ 使用线程：10，然后循环5000次，共5万个样本
+ 使用线程：15，然后循环5000次，共7.5万个样本
+ 使用线程：20，然后循环5000次，共10万个样本
+ 使用线程：25，然后循环5000次，共12.5万个样本
+ 使用线程：30，然后循环5000次，共15万个样本
+ 使用线程：35，然后循环5000次，共17.5万个样本
+ 使用线程：40，然后循环5000次，共20万个样本

这样可以快速得到项目的吞吐量上限。

### RT低的接口

一般来说，对于小型服务器性能瓶颈主要在带宽(接口的rt不高的情况下)，会呈现随着压力的上升，TPS不再增加，接口响应时间逐渐在增加，偶尔出现异常，瓶颈凸显。系统的负载不高。CPU、内存正常的情况。

解决办法：

1. 氪金。。。
2. 优化数据包的大小。

> 根据RT和TPS算出服务端并发线程数;
>
> TPS/1000/平均RT == 服务端并发线程数
>
> `在低延时场景下，服务瓶颈主要在服务器带宽。`

### 高RT接口

如果需要压测一个RT比较高的接口，应该使用更多的线程数。

> 将线程数设置在 100 200 300 400 500 600 700 800
>
> 循环请求200次 Ramp-up period(inseconds)的值设为对应线程数的1/10

在高延时场景下，服务瓶颈主要在容器最大并发线程数。

RT=500ms，TPS=800，服务端线程数：= 800/ (1000ms/ RT) = 400

tomcat默认最大线程数为200，应该先优化tomcat，如果tps达到一定高度之后异常率较高，与io模型有关。

